<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê±°ë˜ì²˜ ê´€ë¦¬</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'ë§‘ì€ ê³ ë”•',sans-serif;max-width:720px;margin:36px auto;padding:20px;background:#fafafa}
    h2{margin:0 0 18px;text-align:center}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px 18px;margin:14px 0}
    label{font-weight:700;display:block;margin-top:12px}
    input[type="text"]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;margin-top:6px}
    .row{display:flex;gap:10px;margin-top:12px}
    .row .grow{flex:1}
    .btn{border:none;border-radius:8px;padding:10px 14px;font-size:14px;cursor:pointer}
    .btn-green{background:#22c55e;color:#fff}
    .btn-red{background:#ef4444;color:#fff}
    .btn-ghost{background:#eef2f7;color:#334155}
    .hint{color:#6b7280;font-size:12px;margin-top:6px}
    .list{margin-top:10px;color:#374151;font-size:13px}
    .chip{display:inline-block;margin:4px 6px 0 0;padding:3px 8px;border-radius:9999px;background:#f3f4f6}
  </style>
</head>
<body>
  <h2>ê±°ë˜ì²˜ ê´€ë¦¬ (ì›ìˆ˜ê¸‰ì / ì„ì°¨ì¸)</h2>

  {% if request.args.get('from') == 'add_job' %}
    <p>
      <a href="{{ url_for('add_job') }}"
         style="display:inline-block;margin:8px 0;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;text-decoration:none;">
        â† ì‘ì—… ë“±ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </a>
    </p>
  {% endif %}

  <!-- ì›ìˆ˜ê¸‰ì -->
  <div class="card">
    <h3 style="margin:0 0 8px;">ë°œì£¼ì(ì›ìˆ˜ê¸‰ì)</h3>

    <label for="owner_input">íšŒì‚¬ëª… ì…ë ¥ ë˜ëŠ” ê²€ìƒ‰</label>
    <input type="text" id="owner_input" list="owner_list" placeholder="ì˜ˆ: í™ì˜ˆâ€¦" />
    <datalist id="owner_list">
      {% for c in owners %}
        <option value="{{ c }}"></option>
      {% endfor %}
    </datalist>

    <div class="row">
      <button class="btn btn-green" type="button" onclick="saveOwner()">ì €ì¥</button>
      <button class="btn btn-red"   type="button" onclick="deleteOwner()">ì‚­ì œ</button>
      <button class="btn btn-ghost" type="button" onclick="document.getElementById('owner_input').value=''">ì§€ìš°ê¸°</button>
    </div>
    <div class="hint">ì…ë ¥ê°’ì´ ì—†ìœ¼ë©´ ì €ì¥/ì‚­ì œê°€ ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¯¸ ë¹„ìŠ·í•œ ì´ë¦„ì´ ìˆì„ ê²½ìš° ì €ì¥ ì „ì— í•©ì¹ ì§€ ë¬¼ì–´ë´…ë‹ˆë‹¤.</div>

    <div class="list">
      {% for c in owners %}
        <span class="chip">{{ c }}</span>
      {% endfor %}
    </div>
  </div>

  <!-- ì„ì°¨ì¸ -->
  <div class="card">
    <h3 style="margin:0 0 8px;">ê±´ì„¤ì—…ì(ì„ì°¨ì¸)</h3>

    <label for="tenant_input">íšŒì‚¬ëª… ì…ë ¥ ë˜ëŠ” ê²€ìƒ‰</label>
    <input type="text" id="tenant_input" list="tenant_list" placeholder="ì˜ˆ: ê°€ë‚˜ë‹¤â€¦" />
    <datalist id="tenant_list">
      {% for t in tenants %}
        <option value="{{ t }}"></option>
      {% endfor %}
    </datalist>

    <div class="row">
      <button class="btn btn-green" type="button" onclick="saveTenant()">ì €ì¥</button>
      <button class="btn btn-red"   type="button" onclick="deleteTenant()">ì‚­ì œ</button>
      <button class="btn btn-ghost" type="button" onclick="document.getElementById('tenant_input').value=''">ì§€ìš°ê¸°</button>
    </div>
    <div class="hint">ì…ë ¥ê°’ì´ ì—†ìœ¼ë©´ ì €ì¥/ì‚­ì œê°€ ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>

    <div class="list">
      {% for t in tenants %}
        <span class="chip">{{ t }}</span>
      {% endfor %}
    </div>
  </div>

  <!-- ëŒ€ì‹œë³´ë“œë¡œ -->
  <div style="text-align:center;margin-top:18px;">
    <a class="btn btn-ghost" href="{{ url_for('dashboard') }}">ğŸ  ëŒ€ì‹œë³´ë“œ</a>
  </div>

  <!-- ìˆ¨ê¹€ í¼: ë¼ìš°íŠ¸ê°€ ê¸°ëŒ€í•˜ëŠ” í•„ë“œëª…ìœ¼ë¡œ ì „ì†¡ -->
  <form id="clientForm" method="post" action="{{ url_for('manage_clients') }}" style="display:none;">
    <input type="hidden" name="from" value="{{ request.args.get('from','') }}">
    <input type="hidden" name="kind"   id="f_kind">   <!-- 'primary' | 'tenant' -->
    <input type="hidden" name="action" id="f_action"> <!-- 'add' | 'delete' -->
    <input type="hidden" name="name"   id="f_name">
    <input type="hidden" name="idx"    id="f_idx">
  </form>

  <script>
    // ì„œë²„ ëª©ë¡
    const OWNERS  = {{ owners  | tojson }};
    const TENANTS = {{ tenants | tojson }};

    // ëŠìŠ¨í•œ ë¹„êµìš© ì •ê·œí™”
    const normalize = s => (s||'')
      .toLowerCase()
      .replace(/\s+/g,'')
      .replace(/[()]/g,'')
      .replace(/ãˆœ|\(ì£¼\)|ì£¼ì‹íšŒì‚¬/g,'')
      .replace(/í¬ë ˆì¸|ì¤‘ê¸°|ê±´ì„¤|ê¸°ê³„|ì¥ë¹„/g,'');

    function findCanonical(name, list){
      const n = normalize(name);
      if(!n) return null;
      for(const item of list){
        const m = normalize(item);
        if(m.includes(n) || n.includes(m)) return item;
      }
      return null;
    }

    // ìˆ¨ê¹€ í¼ ì±„ì›Œì„œ ì œì¶œ (ë¼ìš°íŠ¸ í˜•ì‹ì— ë§ì¶¤)
    function submitClients(payload){
      const f = document.getElementById('clientForm');
      f.querySelector('#f_kind').value   = payload.kind   || '';
      f.querySelector('#f_action').value = payload.action || '';
      f.querySelector('#f_name').value   = payload.name   || '';
      f.querySelector('#f_idx').value    = payload.idx    ?? '';
      f.submit();
    }

    // ===== ì›ìˆ˜ê¸‰ì ì €ì¥/ì‚­ì œ =====
    function saveOwner(){
      const input = document.getElementById('owner_input');
      let v = (input.value || '').trim();
      if(!v){ alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }

      const hit = findCanonical(v, OWNERS);
      if(hit && hit !== v){
        if(confirm(`ì´ë¯¸ "${hit}" ë¡œ ì €ì¥ëœ íšŒì‚¬ê°€ ìˆìŠµë‹ˆë‹¤.\nê°™ì€ íšŒì‚¬ë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
          v = hit;
        }
      }
      submitClients({ kind:'primary', action:'add', name:v });
    }
    function deleteOwner(){
      const v = (document.getElementById('owner_input').value || '').trim();
      if(!v){ alert('ì‚­ì œí•  íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const hit = findCanonical(v, OWNERS);
      const idx = hit ? OWNERS.indexOf(hit) : -1;
      if(idx < 0){ alert('ëª©ë¡ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •í™•í•œ ì´ë¦„ì„ ì„ íƒ/ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
      if(!confirm(`"${hit}" í•­ëª©ì„ ì‚­ì œí• ê¹Œìš”?`)) return;
      submitClients({ kind:'primary', action:'delete', idx: idx, name: hit });
    }

    // ===== ì„ì°¨ì¸ ì €ì¥/ì‚­ì œ =====
    function saveTenant(){
      const input = document.getElementById('tenant_input');
      let v = (input.value || '').trim();
      if(!v){ alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }

      const hit = findCanonical(v, TENANTS);
      if(hit && hit !== v){
        if(confirm(`ì´ë¯¸ "${hit}" ë¡œ ì €ì¥ëœ íšŒì‚¬ê°€ ìˆìŠµë‹ˆë‹¤.\nê°™ì€ íšŒì‚¬ë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
          v = hit;
        }
      }
      submitClients({ kind:'tenant', action:'add', name:v });
    }
    function deleteTenant(){
      const v = (document.getElementById('tenant_input').value || '').trim();
      if(!v){ alert('ì‚­ì œí•  íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const hit = findCanonical(v, TENANTS);
      const idx = hit ? TENANTS.indexOf(hit) : -1;
      if(idx < 0){ alert('ëª©ë¡ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •í™•í•œ ì´ë¦„ì„ ì„ íƒ/ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
      if(!confirm(`"${hit}" í•­ëª©ì„ ì‚­ì œí• ê¹Œìš”?`)) return;
      submitClients({ kind:'tenant', action:'delete', idx: idx, name: hit });
    }
  </script>
</body>
</html>
