<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‘ì—… ì „ì²´ ëª©ë¡</title>
  <style>
    body { font-family: sans-serif; max-width: 950px; margin:40px auto; padding:20px; background:#f4f4f4; border-radius:12px;}
    h2 { text-align: center; margin-bottom: 28px;}
    form.search-bar { text-align:center; margin-bottom:22px;}
    form.search-bar input, form.search-bar select { padding:7px 10px; margin-right:7px; border-radius:6px; border:1px solid #ccc; font-size:15px;}
    form.search-bar button { padding:7px 18px; border-radius:6px; border:none; background:#2196F3; color:white; font-size:15px; cursor:pointer;}
    form.search-bar a { margin-left:7px; color:#2196F3; text-decoration:underline;}
    table { width:100%; border-collapse:collapse; background:white; border-radius:10px; overflow:hidden;}
    th, td { padding:12px 10px; text-align:center; border-bottom:1px solid #ddd; word-break:break-word;}
    th { background-color:#eeeeee; }
    tr:hover { background-color:#f1f1f1;}
    .btn {
      display: block;        /* ì„¸ë¡œ ì •ë ¬ */
      width: 80px;
      padding:7px 13px;
      border-radius:6px;
      color:white;
      font-size:14px;
      border:none;
      cursor:pointer;
      margin-bottom: 6px;
      text-align: center;
      text-decoration: none;
    }
    .edit-btn { background:#007bff; }
    .edit-btn:hover { background:#0056b3; }
    .complete-btn { background:#28a745; }
    .complete-btn:hover { background:#218838; }
    .undo-btn { background:#ff9800; }
    .undo-btn:hover { background:#e65100; }
    .delete-btn { background:#f44336; }
    .delete-btn:hover { background:#d32f2f; }

    .action-buttons { margin-top: 12px; }
    .action-buttons button {
      padding: 8px 16px;
      margin-right: 8px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    .delete-selected-btn { background-color: #f44336; color: white; }
    .delete-selected-btn:hover { background-color: #d32f2f; }
    .complete-all-btn { background-color: #28a745; color: white; }
    .complete-all-btn:hover { background-color: #218838; }

    .more-link, .copy-btn {
      color: #2196F3;
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
      margin-left: 5px;
    }

    .copy-btn {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>ì „ì²´ ì‘ì—… ê´€ë¦¬</h2>
  <form class="search-bar" method="get">
    <input type="text" name="worker" placeholder="ê¸°ì‚¬ëª…" value="{{ request.args.get('worker', '') }}">
    <input type="text" name="machine" placeholder="ì¥ë¹„ëª…" value="{{ request.args.get('machine', '') }}">
    <input type="text" name="client" placeholder="ê±°ë˜ì²˜" value="{{ request.args.get('client', '') }}">
    <input type="date" name="date" value="{{ request.args.get('date', '') }}">
    <button type="submit">ê²€ìƒ‰</button>
    <a href="{{ url_for('jobs') }}">ì´ˆê¸°í™”</a>
  </form>

  <form method="POST" action="{{ url_for('batch_action_jobs') }}">
    {% if jobs %}
    <table>
      <thead>
        <tr>
          <th><input type="checkbox" id="select_all" onclick="toggleAll(this)"></th>
          <th>ë‚ ì§œ</th><th>ì‹œê°„</th><th>ê¸°ì‚¬</th><th>ì¥ë¹„</th><th>ê±°ë˜ì²˜</th>
          <th>ìœ„ì¹˜</th><th>ìš”ì²­ì‚¬í•­</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody>
      {% for job in jobs %}
        <tr>
          <td><input type="checkbox" name="selected_jobs" value="{{ loop.index0 }}"></td>
          <td>{{ job.date }}</td>
          <td>{{ job.time }}</td>
          <!-- ê¸°ì‚¬ -->
          <td>
            {% set val = job.worker %}
            {% if val and val|length > 7 %}
              {{ val[:7] }}...
              <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ê¸°ì‚¬')">ë”ë³´ê¸°</span>
            {% else %}
              {{ val }}
            {% endif %}
          </td>
          <!-- ì¥ë¹„ -->
          <td>
            {% set val = job.machine_name or job.machine %}
            {% if val and val|length > 7 %}
              {{ val[:7] }}...
              <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ì¥ë¹„')">ë”ë³´ê¸°</span>
            {% else %}
              {{ val }}
            {% endif %}
          </td>
          <!-- ê±°ë˜ì²˜ -->
          <td>
            {% set val = job.client %}
            {% if val and val|length > 7 %}
              {{ val[:7] }}...
              <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ê±°ë˜ì²˜')">ë”ë³´ê¸°</span>
            {% else %}
              {{ val }}
            {% endif %}
          </td>
          <!-- ìœ„ì¹˜ -->
          <td>
            {% set val = job.location %}
            {% if val and val|length > 7 %}
              {{ val[:7] }}...
              <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ìœ„ì¹˜')">ë”ë³´ê¸°</span>
            {% else %}
              {{ val }}
            {% endif %}
            {% if val %}
              <span class="copy-btn" onclick="copyToClipboard('{{ val|replace("'", "\\'") }}')">ë³µì‚¬</span>
            {% endif %}
          </td>
          <!-- ìš”ì²­ì‚¬í•­ -->
          <td>
            {% set val = job.note %}
            {% if val and val|length > 7 %}
              {{ val[:7] }}...
              <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ìš”ì²­ì‚¬í•­')">ë”ë³´ê¸°</span>
            {% else %}
              {{ val }}
            {% endif %}
          </td>
          <td>{{ job.status if job.status else 'ì§„í–‰ì¤‘' }}</td>
          <td>
            {% if job.status == 'ì™„ë£Œ' %}
              <a href="{{ url_for('toggle_complete', job_index=loop.index0, **request.args) }}" class="btn undo-btn"
                 onclick="return confirm('ì™„ë£Œ ìƒíƒœë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì™„ë£Œì·¨ì†Œ</a>
            {% else %}
              <a href="{{ url_for('toggle_complete', job_index=loop.index0, **request.args) }}" class="btn complete-btn"
                 onclick="return confirm('ì‘ì—…ì„ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì™„ë£Œ</a>
            {% endif %}
            <a href="{{ url_for('edit_job', job_index=loop.index0, **request.args) }}" class="btn edit-btn">ìˆ˜ì •</a>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="action-buttons">
      <button type="submit" name="action" value="delete_selected" class="delete-selected-btn" onclick="return confirm('ì„ íƒí•œ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì„ íƒ ì‚­ì œ</button>
      <button type="submit" name="action" value="complete_selected" class="complete-all-btn" onclick="return confirm('ì„ íƒí•œ ì‘ì—…ì„ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì„ íƒ ì‘ì—… ì™„ë£Œ</button>
    </div>
    {% else %}
      <p style="text-align:center;">ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </form>

  <form action="{{ url_for('dashboard') }}" method="get" style="margin-top:20px;">
  <button type="submit" style="font-size: 16px; cursor:pointer;">ğŸ  ë©”ì¸í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</form>

  <!-- ë”ë³´ê¸° ëª¨ë‹¬ -->
  <div id="modalBg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); justify-content:center; align-items:center; z-index:1000;">
    <div id="modalContent" style="background:white; padding:36px 32px; border-radius:12px; min-width:260px; max-width:90vw; box-shadow:0 2px 16px rgba(0,0,0,0.18); text-align:center;">
      <h3 id="modalTitle" style="margin-bottom:18px;">ìƒì„¸ ë‚´ìš©</h3>
      <div id="modalText"></div>
      <button class="close-btn" onclick="closeModal()" style="margin-top:24px; background:#2196F3; color:white; font-size:15px; border:none; padding:10px 32px; border-radius:7px; cursor:pointer;">ë‹«ê¸°</button>
    </div>
  </div>

  <script>
    function showMore(val, title){
      document.getElementById('modalBg').style.display='flex';
      document.getElementById('modalText').innerHTML = val.replace(/\\n/g, '<br>');
      document.getElementById('modalTitle').innerText = title + ' ì „ì²´ ë‚´ìš©';
    }
    function closeModal(){
      document.getElementById('modalBg').style.display='none';
    }
    window.onclick = function(event) {
      var modal = document.getElementById('modalBg');
      if(event.target === modal) closeModal();
    }

    function toggleAll(source) {
      const checkboxes = document.getElementsByName('selected_jobs');
      for(let i=0; i<checkboxes.length; i++){
        checkboxes[i].checked = source.checked;
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: ' + text);
      }).catch(err => {
        alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err);
      });
    }
  </script>
</body>
</html>
