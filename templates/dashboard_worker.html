<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì‘ì—… ëª©ë¡</title>
    <style>
        body { font-family: 'ë§‘ì€ ê³ ë”•', Malgun Gothic, ë‹ì›€, Dotum, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        h2 { text-align: center; margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #ddd; word-break: break-all; white-space: normal; position: relative; }
        th { background-color: #eeeeee; }
        tr:hover { background-color: #f1f1f1; }
        .btn { padding: 7px 13px; border-radius: 6px; color: white; font-size: 14px; border: none; cursor: pointer; margin: 2px 0; min-width: 64px; white-space: nowrap; display: block; }
        .edit-btn { background-color: #007bff; }
        .edit-btn:hover { background-color: #0056b3; }
        .complete-btn { background-color: #28a745; }
        .complete-btn:hover { background-color: #218838; }
        .undo-btn { background-color: #ff9800; }
        .undo-btn:hover { background-color: #e65100; }
        .actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: center;
            justify-content: center;
            min-width: 72px;
            /* ë‘ ì¤„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        }
        .more-link {
            color: #2196F3;
            cursor: pointer;
            font-size: 13px;
            text-decoration: underline;
            margin-left: 3px;
        }
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #modalBg {
            display: none;
            position: fixed;
            left: 0; top: 0;
            width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.25);
            justify-content: center; align-items: center;
            z-index: 1000;
        }
        #modalContent {
            background: white;
            padding: 36px 32px;
            border-radius: 12px;
            min-width: 260px;
            max-width: 90vw;
            box-shadow: 0 2px 16px rgba(0,0,0,0.18);
            text-align: center;
        }
        #modalContent h3 {
            margin-bottom: 18px;
        }
        #modalContent .close-btn {
            margin-top: 24px;
            background: #2196F3;
            color: white;
            font-size: 15px;
            border: none;
            padding: 10px 32px;
            border-radius: 7px;
            cursor: pointer;
        }
        #modalContent .close-btn:hover {
            background: #1976D2;
        }
        /* ë³µì‚¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .copy-btn {
            font-size: 12px;
            color: #4caf50;
            cursor: pointer;
            margin-left: 5px;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h2>ì „ì²´ ì‘ì—… ê´€ë¦¬</h2>
    <!-- ê²€ìƒ‰ í¼ ë“± ìƒëµ -->
    <table>
        <thead>
            <tr>
                <th>ë‚ ì§œ</th>
                <th>ì‹œê°„</th>
                <th>ê¸°ì‚¬</th>
                <th>ì¥ë¹„</th>
                <th>ê±°ë˜ì²˜</th>
                <th>ìœ„ì¹˜</th>
                <th>ìš”ì²­ì‚¬í•­</th>
                <th>ìƒíƒœ</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody>
        {% for job in jobs %}
            <tr>
                <td>{{ job.date }}</td>
                <td>{{ job.time }}</td>
                <!-- ê¸°ì‚¬ -->
                <td>
                  {% set val = job.worker or job.username %}
                  {% if val and val|length > 7 %}
                    {{ val[:7] ~ '...' }}
                    <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ê¸°ì‚¬')">ë”ë³´ê¸°</span>
                  {% else %}
                    {{ val }}
                  {% endif %}
                </td>
                <!-- ì¥ë¹„ -->
                <td>
                  {% set val = job.machine_name or job.machine %}
                  {% if val and val|length > 7 %}
                    {{ val[:7] ~ '...' }}
                    <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ì¥ë¹„')">ë”ë³´ê¸°</span>
                  {% else %}
                    {{ val }}
                  {% endif %}
                </td>
                <!-- ê±°ë˜ì²˜ -->
                <td>
                  {% set val = job.client %}
                  {% if val and val|length > 7 %}
                    {{ val[:7] ~ '...' }}
                    <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ê±°ë˜ì²˜')">ë”ë³´ê¸°</span>
                  {% else %}
                    {{ val }}
                  {% endif %}
                </td>
                <!-- ìœ„ì¹˜ -->
                <td>
                  {% set val = job.location %}
                  {% if val and val|length > 7 %}
                    {{ val[:7] ~ '...' }}
                    <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ìœ„ì¹˜')">ë”ë³´ê¸°</span>
                    <span class="copy-btn" onclick="copyToClipboard('{{ val|replace("'", "\\'") }}')">ë³µì‚¬</span>
                  {% else %}
                    {{ val }}
                    <span class="copy-btn" onclick="copyToClipboard('{{ val|replace("'", "\\'") }}')">ë³µì‚¬</span>
                  {% endif %}
                </td>
                <!-- ìš”ì²­ì‚¬í•­ -->
                <td>
                  {% set val = job.note %}
                  {% if val and val|length > 7 %}
                    {{ val[:7] ~ '...' }}
                    <span class="more-link" onclick="showMore('{{ val|replace("'", "\\'")|replace('\n','<br>') }}','ìš”ì²­ì‚¬í•­')">ë”ë³´ê¸°</span>
                  {% else %}
                    {{ val }}
                  {% endif %}
                </td>
                <td>{{ job.status if job.status else 'ì§„í–‰ì¤‘' }}</td>
                <td class="actions">
                    {% if job.status == 'ì™„ë£Œ' %}
                        <a href="{{ url_for('toggle_complete', job_index=loop.index0) }}" class="btn undo-btn"
                           onclick="return confirm('ì™„ë£Œ ìƒíƒœë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì™„ë£Œì·¨ì†Œ</a>
                    {% else %}
                        <a href="{{ url_for('toggle_complete', job_index=loop.index0) }}" class="btn complete-btn"
                           onclick="return confirm('ì‘ì—…ì„ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì™„ë£Œ</a>
                    {% endif %}
                    <a href="{{ url_for('edit_job', job_index=loop.index0) }}" class="btn edit-btn">ìˆ˜ì •</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

<a href="{{ url_for('edit_worker') }}" class="btn edit-btn">ë‚´ ì •ë³´ ìˆ˜ì •</a>
<form action="{{ url_for('logout') }}" method="post" style="display:inline;">
  <button type="submit" style="font-size: 16px; padding: 6px 14px; cursor: pointer;">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
</form>

    <!-- ë”ë³´ê¸° ëª¨ë‹¬ -->
    <div id="modalBg">
        <div id="modalContent">
            <h3 id="modalTitle">ìƒì„¸ ë‚´ìš©</h3>
            <div id="modalText"></div>
            <button class="close-btn" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>
    <script>
      function showMore(val, title){
        document.getElementById('modalBg').style.display='flex';
        document.getElementById('modalText').innerHTML = val.replace(/\\n/g, '<br>');
        document.getElementById('modalTitle').innerText = title + ' ì „ì²´ ë‚´ìš©';
      }
      function closeModal(){
        document.getElementById('modalBg').style.display='none';
      }
      window.onclick = function(event) {
        var modal = document.getElementById('modalBg');
        if (event.target === modal) closeModal();
      }
      function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
          alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: ' + text);
        }, () => {
          alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        });
      }
    </script>
</body>
</html>
