<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¸°ì‚¬ ë“±ë¡/ê´€ë¦¬</title>
  <style>
    :root{
      --blue:#2563eb; --green:#22c55e; --red:#ef4444; --gray:#9ca3af;
      --bg:#f8f9fa; --card:#ffffff; --border:#e5e7eb;
    }
    body{font-family:'ë§‘ì€ ê³ ë”•', Malgun Gothic, Dotum, sans-serif; max-width:780px; margin:36px auto; padding:20px; background:var(--bg);}
    h2{margin:0 0 18px; text-align:center;}
    .card{background:var(--card); border:1px solid var(--border); border-radius:12px; padding:18px 20px; box-shadow:0 2px 10px rgba(0,0,0,.04);}
    label{font-weight:700; display:block; margin:10px 0 6px;}
    input[type="text"]{width:100%; padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; font-size:15px;}
    .btn{display:inline-block; border:none; border-radius:8px; padding:9px 14px; font-size:14px; color:#fff; cursor:pointer; text-decoration:none}
    .btn-primary{background:var(--green);} .btn-primary:hover{background:#16a34a;}
    .btn-blue{background:var(--blue);}   .btn-blue:hover{background:#1d4ed8;}
    .btn-red{background:var(--red);}     .btn-red:hover{background:#dc2626;}
    .btn-gray{background:#e5e7eb; color:#111827;} .btn-gray:hover{background:#d1d5db;}
    .stack{display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;}
    .list{margin-top:16px;}
    .item{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px; border:1px solid var(--border); border-radius:10px; background:#fff;}
    .who{font-size:15px; font-weight:700;}
    .role{display:inline-block; margin:0 6px; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700; background:#eef2ff; color:#3730a3;}
    .role.manager{background:#dcfce7; color:#065f46;}
    .role.pending{background:#fff7ed; color:#9a3412;}
    .actions{display:flex; gap:8px; flex-wrap:wrap;}
    .muted{color:#6b7280; font-size:13px; margin-top:8px;}
    hr{border:none; border-top:1px solid var(--border); margin:18px 0;}
    .footer{margin-top:18px; text-align:center;}
    form.inline { display:inline; }
  </style>
</head>
<body>
  <h2>ê¸°ì‚¬ ë“±ë¡/ê´€ë¦¬</h2> 
  {% if request.args.get('from') == 'add_job' %}
    <p>
      <a href="{{ url_for('add_job') }}"
         style="display:inline-block;margin:8px 0;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;text-decoration:none;">
        â† ì‘ì—… ë“±ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </a>
    </p>
  {% endif %}

  {% if error %}
    <div class="card" style="border-color:#fecaca; background:#fef2f2; color:#991b1b; margin-bottom:12px;">
      {{ error }}
    </div>
  {% endif %}

  <!-- ë“±ë¡ í¼ -->
  <div class="card" style="margin-bottom:16px;">
    <form method="POST" class="stack" autocomplete="off">
      <!-- from ë³´ì¡´ -->
      <input type="hidden" name="from" value="{{ request.args.get('from','') }}">

      <div style="flex:1; min-width:200px;">
        <label for="w_name">ì´ë¦„</label>
        <input id="w_name" type="text" name="name" placeholder="ì˜ˆ: í™ê¸¸ë™" required>
      </div>
      <div style="flex:1; min-width:220px;">
        <label for="w_phone">ì „í™”ë²ˆí˜¸</label>
        <input id="w_phone" type="text" name="phone" inputmode="numeric" pattern="[0-9]{10,11}"
               title="ìˆ«ì 10~11ìë¦¬" placeholder="01012345678" required>
      </div>
      <div>
        <button type="submit" class="btn btn-primary">ë“±ë¡</button>
      </div>
    </form>
    <div class="muted">â€» ì „í™”ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”. ë“±ë¡í›„ ê¸°ì‚¬ ë¡œê·¸ì¸ì‹œ ë¹„ë°€ë²ˆí˜¸ëŠ” íœ´ëŒ€í°ë²ˆí˜¸ ë’·4ìë¦¬ ì…ë‹ˆë‹¤.</div>
  </div>

  <!-- ëª©ë¡ -->
  <div class="card">
    <h3 style="margin:0 0 10px;">ë“±ë¡ëœ ê¸°ì‚¬ ëª©ë¡</h3>

    <div class="list">
      {% for w in workers %}
        {% set _role = (w.get('role') or 'worker') %}
        {% set is_manager = _role in ['manager','boss'] %}
        {% set badge_text = 'ê´€ë¦¬ì' if is_manager else 'ê¸°ì‚¬' %}
        {% set badge_class = 'manager' if is_manager else '' %}

        <div class="item">
          <div class="who">
            {{ w.name }}
            <span class="role {{ 'pending' if (w.get('status') == 'pending') else badge_class }}">
              {% if w.get('status') == 'pending' %}ê°€ì…ëŒ€ê¸°{% else %}{{ badge_text }}{% endif %}
            </span>
            ({{ w.phone }})
          </div>

          <div class="actions">
            {% if (w.get('status') or '') == 'pending' %}
              <form class="inline" action="{{ url_for('approve_worker', username=w.username) }}" method="post">
                <input type="hidden" name="from" value="{{ request.args.get('from','') }}">
                <button class="btn btn-blue" type="submit">ìŠ¹ì¸</button>
              </form>
              <form class="inline" action="{{ url_for('delete_worker', username=w.username) }}" method="post">
                <input type="hidden" name="from" value="{{ request.args.get('from','') }}">
                <button class="btn btn-red" type="submit" onclick="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ê±°ì ˆ</button>
              </form>
            {% else %}
              {# ìˆ˜ì • ë§í¬ì— from ì¿¼ë¦¬ ë¶€ì°© (ìˆìœ¼ë©´) #}
              {% if request.args.get('from') %}
                <a class="btn btn-blue"
                   href="{{ url_for('edit_worker', worker_username=w.username, from=request.args.get('from')) }}">
                  ìˆ˜ì •
                </a>
              {% else %}
                <a class="btn btn-blue"
                   href="{{ url_for('edit_worker', worker_username=w.username) }}">
                  ìˆ˜ì •
                </a>
              {% endif %}

              <form class="inline" action="{{ url_for('delete_worker', username=w.username) }}" method="post">
                <input type="hidden" name="from" value="{{ request.args.get('from','') }}">
                <button class="btn btn-red" type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì‚­ì œ</button>
              </form>

              {% if w.get('role') in ['manager','boss'] %}
                <form class="inline" action="{{ url_for('revoke_manager', username=w.username) }}" method="post">
                  <input type="hidden" name="from" value="{{ request.args.get('from','') }}">
                  <button class="btn btn-gray" type="submit">ê´€ë¦¬ìí•´ì œ</button>
                </form>
              {% else %}
                <form class="inline" action="{{ url_for('grant_manager', username=w.username) }}" method="post">
                  <input type="hidden" name="from" value="{{ request.args.get('from','') }}">
                  <button class="btn btn-primary" type="submit"
                          onclick="return confirm('í•´ë‹¹ ì§ì›ì„ ê´€ë¦¬ìë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê´€ë¦¬ìëŠ” ì‚¬ì¥ê³¼ ë™ì¼í•œ ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤. ì‹ ì¤‘íˆ ë¶€ì—¬í•˜ì„¸ìš”.');">
                    ê´€ë¦¬ìê¶Œí•œ
                  </button>
                </form>
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% else %}
        <div class="muted">ë“±ë¡ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      {% endfor %}
    </div>

    <hr>
    <div class="footer">
      <a class="btn btn-gray" href="{{ url_for('dashboard') }}">ğŸ  ë©”ì¸í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>
</body>
</html>
